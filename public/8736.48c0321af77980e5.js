"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8736],{8736:(B,S,c)=>{c.r(S),c.d(S,{SeguimientoPageModule:()=>Y});var b=c(6895),d=c(4719),a=c(1558),v=c(2507),h=c(5861),x=c(2304),Z=c(9337),T=c(1764),e=c(6353),y=c(8555),w=c(5970),P=c(725),I=c(1188);const k=["video"],A=["canvas"];function M(i,s){if(1&i&&(e.TgZ(0,"div",8),e._UZ(1,"video",9,10)(3,"canvas",11,12),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.ekj("show",!t.isCaptured)("hide",t.isCaptured),e.Q6J("width",t.WIDTH)("height",t.HEIGHT),e.xp6(2),e.ekj("show",t.isCaptured)("hide",!t.isCaptured),e.Q6J("width",t.WIDTH)("height",t.HEIGHT)}}function U(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"ion-button",13),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.capture())}),e._uU(1,"Tomar foto"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("disabled",t.captures.length>=t.maximoCapturas)}}function G(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"ion-button",14),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.removeCurrent())}),e._uU(1,"Toma otra"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("disabled",t.captures.length>=t.maximoCapturas)}}function J(i,s){if(1&i&&(e.TgZ(0,"div",15),e._uU(1),e.TgZ(2,"div",16),e._UZ(3,"img",17),e.qZA()()),2&i){const t=e.oxw();e.xp6(1),e.hij(" ",t.error,". Please click refresh ")}}function H(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"li",18),e.NdJ("click",function(){const g=e.CHM(t).index,C=e.oxw();return e.KtG(C.setPhoto(g))}),e._UZ(1,"img",19),e.qZA()}if(2&i){const t=s.$implicit;e.xp6(1),e.Q6J("src",t,e.LSH)}}let W=(()=>{class i{constructor(){var t=this;this.fotosCargar=new e.vpe,this.WIDTH=640,this.HEIGHT=480,this.captures=[],this.maximoCapturas=3,this.videoParam=new e.vpe,this.setupDevices=(0,h.Z)(function*(){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)try{const n=yield navigator.mediaDevices.getUserMedia({video:!0});n?(t.video.nativeElement.srcObject=n,t.video.nativeElement.play(),t.error=null):t.error="No tienes dispositivo de salida de video"}catch(n){t.error=n}}),this.capture=()=>{this.drawImageToCanvas(this.video.nativeElement),this.captures.push(this.canvas.nativeElement.toDataURL("image/png")),this.isCaptured=!0,this.fotosCargar.emit(this.captures),this.videoParam.emit(this.video)},this.removeCurrent=()=>{this.isCaptured=!1},this.setPhoto=n=>{this.isCaptured=!0;var o=new Image;o.src=this.captures[n],this.drawImageToCanvas(o)},this.drawImageToCanvas=n=>{this.canvas.nativeElement.getContext("2d").drawImage(n,0,0,this.WIDTH,this.HEIGHT)}}ngAfterViewInit(){var t=this;return(0,h.Z)(function*(){yield t.setupDevices()})()}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-webcam-snapshot"]],viewQuery:function(t,n){if(1&t&&(e.Gf(k,5),e.Gf(A,5)),2&t){let o;e.iGM(o=e.CRH())&&(n.video=o.first),e.iGM(o=e.CRH())&&(n.canvas=o.first)}},outputs:{fotosCargar:"fotosCargar",videoParam:"videoParam"},decls:12,vars:5,consts:[["class","video-container",4,"ngIf"],[1,"snap-container"],["color","danger"],["color","primary","expand","block",3,"disabled","click",4,"ngIf"],["color","danger","expand","block",3,"disabled","click",4,"ngIf"],["class","text-danger mt-4",4,"ngIf"],[1,"list-unstyled"],[3,"click",4,"ngFor","ngForOf"],[1,"video-container"],["id","video","autoplay","",3,"width","height"],["video",""],["id","canvas",3,"width","height"],["canvas",""],["color","primary","expand","block",3,"disabled","click"],["color","danger","expand","block",3,"disabled","click"],[1,"text-danger","mt-4"],[1,"mt-5"],["src","https://trungk18.com/7e0976255739e721501803ee074f1f94/camera.gif"],[3,"click"],["height","50",3,"src"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-content"),e.YNc(1,M,5,12,"div",0),e.TgZ(2,"div",1)(3,"ion-label",2),e._uU(4,"M\xe1ximo 3 capturas"),e.qZA(),e.TgZ(5,"ion-row")(6,"ion-col"),e.YNc(7,U,2,1,"ion-button",3),e.YNc(8,G,2,1,"ion-button",4),e.qZA()(),e.YNc(9,J,4,1,"div",5),e.qZA(),e.TgZ(10,"ul",6),e.YNc(11,H,2,1,"li",7),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("ngIf",!n.error),e.xp6(6),e.Q6J("ngIf",!n.isCaptured),e.xp6(1),e.Q6J("ngIf",n.isCaptured),e.xp6(1),e.Q6J("ngIf",n.error),e.xp6(2),e.Q6J("ngForOf",n.captures))},dependencies:[b.sg,b.O5,a.YG,a.wI,a.W2,a.Q$,a.Nd],styles:[".snap-container[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:16px;text-align:center}.list-unstyled[_ngcontent-%COMP%]{list-style:none}.list-unstyled[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:inline-block;padding:5px 10px;cursor:pointer}.show[_ngcontent-%COMP%]{display:block}.hide[_ngcontent-%COMP%]{display:none}"]}),i})();const D=["video"];function E(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1)(3,"ion-button",11),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.cancel())}),e._uU(4,"Cancelar"),e.qZA()(),e.TgZ(5,"ion-title",0),e._uU(6,"Agregar Fotos"),e.qZA(),e.TgZ(7,"ion-buttons",12)(8,"ion-button",13),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.confirm())}),e._uU(9,"Confirmar"),e.qZA()()()(),e.TgZ(10,"ion-content",14)(11,"app-webcam-snapshot",15),e.NdJ("fotosCargar",function(o){e.CHM(t);const g=e.oxw();return e.KtG(g.captures=o)})("videoParam",function(o){e.CHM(t);const g=e.oxw();return e.KtG(g.video=o)}),e.qZA()()}2&i&&(e.xp6(8),e.Q6J("strong",!0))}const N=[{path:"",component:(()=>{class i{constructor(t,n,o,g,C,F){var r=this;this.loaderService=t,this.alertService=n,this.router=o,this.seguimientoService=g,this.actRoute=C,this.storageService=F,this.captures=[],this.inicializar=()=>{const l=T(new Date,"YYYY-MM-DD").format();this.id=this.actRoute.snapshot.paramMap.get("id"),this.form=new d.cw({observacion:new d.NI("",d.kI.required),fecha:new d.NI(l,d.kI.required)})},this.guardarSeguimiento=(0,h.Z)(function*(){const l=new x.h;l.cultivo.id=r.id,l.observacion=r.form.value.observacion,l.fecha=r.form.value.fecha;const m=[];for(let u=0;u<r.captures.length;u++){const _=r.dataURItoBlob(r.captures[u].split(",")[1]),f=new File([_],`capture${u}`,{type:"image/png"});m.push(f)}l.capturas=m;try{yield r.loaderService.simpleLoader("cargando"),yield r.seguimientoService.seguimientoGuardar(l),yield r.loaderService.dismissLoader(),yield r.router.navigateByUrl(`/seguimientos/${r.id}`)}catch(u){console.log("guardarSeguimiento error",u),r.porSincronizar(l),r.seguimientoService.backgroundSync(),r.loaderService.dismissLoader();const p=new Z.b;p.header="Error al registrar seguimiento",p.message="Sin Internet. El seguimiento se sincronizar\xe1 autom\xe1ticamente al retomar conectividad",p.buttons=[{text:"OK",role:"confirm",handler:(_=(0,h.Z)(function*(){r.router.navigateByUrl(`/seguimientos/${r.id}`)}),function(){return _.apply(this,arguments)})}],r.alertService.simpleAlert(p)}var _}),this.cancel=()=>{this.detenerCamara(),this.modal.dismiss(null,"cancel")},this.confirm=()=>{this.detenerCamara(),this.modal.dismiss(null,"confirm")},this.onWillDismiss=function(){var l=(0,h.Z)(function*(m){"backdrop"===m.detail.role&&r.detenerCamara()});return function(m){return l.apply(this,arguments)}}(),this.dataURItoBlob=l=>{const m=window.atob(l),u=new ArrayBuffer(m.length),p=new Uint8Array(u);for(let f=0;f<m.length;f++)p[f]=m.charCodeAt(f);return new Blob([p],{type:"image/png"})},this.detenerCamara=(0,h.Z)(function*(){r.video.nativeElement.srcObject.getTracks().forEach(function(u){u.stop()}),r.video.nativeElement.srcObject=null}),this.porSincronizar=function(){var l=(0,h.Z)(function*(m){const u=yield r.seguimientoService.seguimientosObtenerStorage();u.push(m),r.storageService.set("seguimientos",u),r.storageService.set("seguimientos-sync",[])});return function(m){return l.apply(this,arguments)}}(),this.inicializar()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(y.D),e.Y36(w.c),e.Y36(v.F0),e.Y36(P.Z),e.Y36(v.gz),e.Y36(I.V))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-seguimiento"]],viewQuery:function(t,n){if(1&t&&(e.Gf(a.ki,5),e.Gf(D,5)),2&t){let o;e.iGM(o=e.CRH())&&(n.modal=o.first),e.iGM(o=e.CRH())&&(n.video=o.first)}},decls:24,vars:3,consts:[[1,"ion-text-center"],["slot","start"],["defaultHref","seguimientos","text",""],[3,"formGroup","ngSubmit"],["trigger","open-modal",3,"willDismiss"],["lines","full"],["position","floating"],["rows","6","cols","20","formControlName","observacion","clearOnEdit","true","placeholder","Ingrese cualquier nota aqu\xed..."],["locale","es-ES","formControlName","fecha","presentation","date",3,"firstDayOfWeek"],["id","open-modal","expand","block","fill","outline"],["type","submit","color","primary","expand","block",3,"disabled"],[3,"click"],["slot","end"],[3,"strong","click"],[1,"ion-padding"],[3,"fotosCargar","videoParam"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title",0),e._uU(3,"Seguimiento"),e.qZA(),e.TgZ(4,"ion-buttons",1),e._UZ(5,"ion-back-button",2),e.qZA()()(),e.TgZ(6,"ion-content")(7,"form",3),e.NdJ("ngSubmit",function(){return n.guardarSeguimiento()}),e.TgZ(8,"ion-modal",4),e.NdJ("willDismiss",function(g){return n.onWillDismiss(g)}),e.YNc(9,E,12,1,"ng-template"),e.qZA(),e.TgZ(10,"ion-item",5)(11,"ion-label",6),e._uU(12,"Observaci\xf3n"),e.qZA(),e._UZ(13,"ion-textarea",7),e.qZA(),e.TgZ(14,"ion-item",5)(15,"ion-label",6),e._uU(16,"Fecha"),e.qZA(),e._UZ(17,"ion-datetime",8),e.qZA(),e.TgZ(18,"ion-row")(19,"ion-col")(20,"ion-button",9),e._uU(21,"Agregar Fotos"),e.qZA(),e.TgZ(22,"ion-button",10),e._uU(23,"Guardar"),e.qZA()()()()()),2&t&&(e.xp6(7),e.Q6J("formGroup",n.form),e.xp6(10),e.Q6J("firstDayOfWeek",1),e.xp6(5),e.Q6J("disabled",!n.form.valid))},dependencies:[d._Y,d.JJ,d.JL,a.oU,a.YG,a.Sm,a.wI,a.W2,a.x4,a.Gu,a.Ie,a.Q$,a.ki,a.Nd,a.g2,a.sr,a.wd,a.QI,a.j9,a.cs,d.sg,d.u,W]}),i})()}];let Q=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[v.Bz.forChild(N),v.Bz]}),i})();var O=c(5642);let Y=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[b.ez,d.u5,a.Pc,Q,d.UX,O.K]}),i})()}}]);