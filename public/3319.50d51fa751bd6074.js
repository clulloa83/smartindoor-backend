(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3319,1764,7379,7276],{3319:(G,E,v)=>{"use strict";v.r(E),v.d(E,{ProgramaEditarPageModule:()=>C});var k=v(6895),p=v(4719),h=v(1558),D=v(2507),Z=v(5861),P=v(1764),N=v(6582),M=v(9337),t=v(6353),w=v(9498),A=v(8555),H=v(5970),L=v(8077);function z(d,l){if(1&d&&(t.TgZ(0,"div",12)(1,"label"),t._UZ(2,"input",13),t._uU(3),t.qZA()()),2&d){const a=l.$implicit;t.xp6(2),t.s9C("value",a.id),t.xp6(1),t.hij("",a.id," ")}}function Q(d,l){if(1&d&&(t.TgZ(0,"ion-item")(1,"ion-label"),t._uU(2),t.qZA(),t._UZ(3,"ion-checkbox",20),t.qZA()),2&d){const a=l.index,f=t.oxw(2);t.xp6(2),t.Oqu(f.dias[a].id),t.xp6(1),t.Q6J("formControlName",a)}}function F(d,l){if(1&d){const a=t.EpF();t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1)(3,"ion-button",14),t.NdJ("click",function(){t.CHM(a);const y=t.oxw();return t.KtG(y.cancel())}),t._uU(4,"Cancelar"),t.qZA()(),t.TgZ(5,"ion-title",0),t._uU(6,"Repetir"),t.qZA(),t.TgZ(7,"ion-buttons",15)(8,"ion-button",16),t.NdJ("click",function(){t.CHM(a);const y=t.oxw();return t.KtG(y.confirm())}),t._uU(9,"Confirmar"),t.qZA()()()(),t.TgZ(10,"ion-content",17),t.ynx(11,18),t.YNc(12,Q,4,2,"ion-item",19),t.BQk(),t.qZA()}if(2&d){const a=t.oxw();t.xp6(8),t.Q6J("strong",!0),t.xp6(4),t.Q6J("ngForOf",a.diasFormArray.controls)}}const x=[{path:"",component:(()=>{class d{constructor(a,f,y,u,i,r){var o=this;this.actRoute=a,this.Navparams=f,this.loaderService=y,this.alertService=u,this.programaService=i,this.router=r,this.acciones=[{id:"ENCENDIDO",checked:!0},{id:"APAGADO",checked:!1}],this.dias=[{id:"Lun",checked:!1},{id:"Mar",checked:!1},{id:"Mie",checked:!1},{id:"Jue",checked:!1},{id:"Vie",checked:!1},{id:"Sab",checked:!1},{id:"Dom",checked:!1}],this.inicializar=()=>{this.id=this.actRoute.snapshot.paramMap.get("id"),this.programa=this.Navparams.getData();const e=P(this.fechaObtener(),"YYYY-MM-DD").format();this.form=new p.cw({hora:new p.NI(e,p.kI.required),accion:new p.NI("",p.kI.required),dias:new p.Oe([])});const s=this.programa.dias;this.dias.forEach(n=>{s.find(m=>m===n.id)?(n.checked=!0,this.diasFormArray.push(new p.NI(!0))):(n.checked=!1,this.diasFormArray.push(new p.NI(!1)))}),this.form.patchValue({accion:this.programa.accion})},this.diasObtener=()=>{const e=this.programa.dias;return this.dias.forEach(s=>{s.checked=!!e.find(c=>c===s.id)}),this.dias.map(s=>s.checked)},this.fechaObtener=()=>{const e=this.programa.hora,s=e.split(":")[0],n=e.split(":")[1],c=new Date(Date.now()),m=c.getFullYear(),g=c.getMonth(),$=c.getDay();return new Date(m,g,$,Number(s),Number(n))},this.cancel=()=>{const e=this.diasObtener();this.form.patchValue({dias:e}),this.modal.dismiss(null,"cancel")},this.confirm=()=>{this.modal.dismiss(null,"confirm")},this.guardarPrograma=(0,Z.Z)(function*(){const e=o.form.value.dias.map((n,c)=>n?o.dias[c].id:null).filter(n=>null!==n),s=new N.i;s.id=o.id,s.accion=o.form.value.accion,s.hora=P(o.form.value.hora).format("HH:mm"),s.dias=e;try{yield o.loaderService.simpleLoader("cargando"),yield o.programaService.programaActualizarPorId(s),yield o.loaderService.dismissLoader();const n=new M.b;n.header="Edici\xf3n Programa",n.message="Se ha editado correctamente el programa",n.buttons=[{text:"OK",role:"confirm",handler:(c=(0,Z.Z)(function*(){yield o.router.navigate([`programas/${o.programa.dispositivo}`])}),function(){return c.apply(this,arguments)})}],o.alertService.simpleAlert(n)}catch(n){console.log("programaActualizarPorId error",n),o.loaderService.dismissLoader();const c=new M.b;c.header="Error al editar programa",c.message="Se ha producido un error, favor intentar m\xe1s tarde",c.buttons=["OK"],o.alertService.simpleAlert(c)}var c}),this.inicializar()}get diasFormArray(){return this.form.controls.dias}get repetirDias(){const a=this.form.value.dias.map((f,y)=>f?this.dias[y].id:null).filter(f=>null!==f);return a.length<1?"Una vez":a.length==this.dias.length?"Cada d\xeda":a}onWillDismiss(a){if("backdrop"===a.detail.role){const y=this.diasObtener();this.form.patchValue({dias:y})}}}return d.\u0275fac=function(a){return new(a||d)(t.Y36(D.gz),t.Y36(w.a),t.Y36(A.D),t.Y36(H.c),t.Y36(L.$),t.Y36(D.F0))},d.\u0275cmp=t.Xpm({type:d,selectors:[["app-programa-editar"]],viewQuery:function(a,f){if(1&a&&t.Gf(h.ki,5),2&a){let y;t.iGM(y=t.CRH())&&(f.modal=y.first)}},decls:29,vars:4,consts:[[1,"ion-text-center"],["slot","start"],["defaultHref","programas","text",""],[3,"formGroup","ngSubmit"],["lines","full"],["position","fixed"],["slot","end","formControlName","hora","presentation","time"],["class","radio",4,"ngFor","ngForOf"],["id","open-modal","slot","end"],["slot","icon-only","name","add-outline"],["trigger","open-modal",3,"willDismiss"],["type","submit","color","primary","expand","block",3,"disabled"],[1,"radio"],["type","radio","formControlName","accion",3,"value"],[3,"click"],["slot","end"],[3,"strong","click"],[1,"ion-padding"],["formArrayName","dias"],[4,"ngFor","ngForOf"],["slot","start",3,"formControlName"]],template:function(a,f){1&a&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title",0),t._uU(3,"Programa Editar"),t.qZA(),t.TgZ(4,"ion-buttons",1),t._UZ(5,"ion-back-button",2),t.qZA()()(),t.TgZ(6,"ion-content")(7,"form",3),t.NdJ("ngSubmit",function(){return f.guardarPrograma()}),t.TgZ(8,"ion-item",4)(9,"ion-label",5),t._uU(10,"Hora"),t.qZA(),t._UZ(11,"ion-datetime",6),t.qZA(),t.TgZ(12,"ion-item",4)(13,"ion-label",5),t._uU(14,"Acci\xf3n"),t.qZA(),t.YNc(15,z,4,2,"div",7),t.qZA(),t.TgZ(16,"ion-item",4)(17,"ion-label",5),t._uU(18,"Repetir"),t.qZA(),t.TgZ(19,"ion-label"),t._uU(20),t.qZA(),t.TgZ(21,"ion-button",8),t._UZ(22,"ion-icon",9),t.qZA(),t.TgZ(23,"ion-modal",10),t.NdJ("willDismiss",function(u){return f.onWillDismiss(u)}),t.YNc(24,F,13,2,"ng-template"),t.qZA()(),t.TgZ(25,"ion-row")(26,"ion-col")(27,"ion-button",11),t._uU(28,"Guardar"),t.qZA()()()()()),2&a&&(t.xp6(7),t.Q6J("formGroup",f.form),t.xp6(8),t.Q6J("ngForOf",f.acciones),t.xp6(5),t.Oqu(f.repetirDias),t.xp6(7),t.Q6J("disabled",!f.form.valid))},dependencies:[k.sg,p._Y,p.Fj,p._,p.JJ,p.JL,h.oU,h.YG,h.Sm,h.nz,h.wI,h.W2,h.x4,h.Gu,h.gu,h.Ie,h.Q$,h.ki,h.Nd,h.sr,h.wd,h.w,h.QI,h.cs,p.sg,p.u,p.CE]}),d})()}];let O=(()=>{class d{}return d.\u0275fac=function(a){return new(a||d)},d.\u0275mod=t.oAB({type:d}),d.\u0275inj=t.cJS({imports:[D.Bz.forChild(x),D.Bz]}),d})(),C=(()=>{class d{}return d.\u0275fac=function(a){return new(a||d)},d.\u0275mod=t.oAB({type:d}),d.\u0275inj=t.cJS({imports:[k.ez,p.u5,h.Pc,O,p.UX]}),d})()},1764:function(G){G.exports=function(){"use strict";var v=6e4,k=36e5,p="millisecond",h="second",D="minute",Z="hour",P="day",N="week",M="month",t="quarter",w="year",A="date",H="Invalid Date",L=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,z=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,Q={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},F=function(u,i,r){var o=String(u);return!o||o.length>=i?u:""+Array(i+1-o.length).join(r)+u},q={s:F,z:function(u){var i=-u.utcOffset(),r=Math.abs(i),o=Math.floor(r/60),e=r%60;return(i<=0?"+":"-")+F(o,2,"0")+":"+F(e,2,"0")},m:function u(i,r){if(i.date()<r.date())return-u(r,i);var o=12*(r.year()-i.year())+(r.month()-i.month()),e=i.clone().add(o,M),s=r-e<0,n=i.clone().add(o+(s?-1:1),M);return+(-(o+(r-e)/(s?e-n:n-e))||0)},a:function(u){return u<0?Math.ceil(u)||0:Math.floor(u)},p:function(u){return{M,y:w,w:N,d:P,D:A,h:Z,m:D,s:h,ms:p,Q:t}[u]||String(u||"").toLowerCase().replace(/s$/,"")},u:function(u){return void 0===u}},x="en",O={};O[x]=Q;var C=function(u){return u instanceof f},d=function u(i,r,o){var e;if(!i)return x;if("string"==typeof i){var s=i.toLowerCase();O[s]&&(e=s),r&&(O[s]=r,e=s);var n=i.split("-");if(!e&&n.length>1)return u(n[0])}else{var c=i.name;O[c]=i,e=c}return!o&&e&&(x=e),e||!o&&x},l=function(u,i){if(C(u))return u.clone();var r="object"==typeof i?i:{};return r.date=u,r.args=arguments,new f(r)},a=q;a.l=d,a.i=C,a.w=function(u,i){return l(u,{locale:i.$L,utc:i.$u,x:i.$x,$offset:i.$offset})};var f=function(){function u(r){this.$L=d(r.locale,null,!0),this.parse(r)}var i=u.prototype;return i.parse=function(r){this.$d=function(o){var e=o.date,s=o.utc;if(null===e)return new Date(NaN);if(a.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var n=e.match(L);if(n){var c=n[2]-1||0,m=(n[7]||"0").substring(0,3);return s?new Date(Date.UTC(n[1],c,n[3]||1,n[4]||0,n[5]||0,n[6]||0,m)):new Date(n[1],c,n[3]||1,n[4]||0,n[5]||0,n[6]||0,m)}}return new Date(e)}(r),this.$x=r.x||{},this.init()},i.init=function(){var r=this.$d;this.$y=r.getFullYear(),this.$M=r.getMonth(),this.$D=r.getDate(),this.$W=r.getDay(),this.$H=r.getHours(),this.$m=r.getMinutes(),this.$s=r.getSeconds(),this.$ms=r.getMilliseconds()},i.$utils=function(){return a},i.isValid=function(){return this.$d.toString()!==H},i.isSame=function(r,o){var e=l(r);return this.startOf(o)<=e&&e<=this.endOf(o)},i.isAfter=function(r,o){return l(r)<this.startOf(o)},i.isBefore=function(r,o){return this.endOf(o)<l(r)},i.$g=function(r,o,e){return a.u(r)?this[o]:this.set(e,r)},i.unix=function(){return Math.floor(this.valueOf()/1e3)},i.valueOf=function(){return this.$d.getTime()},i.startOf=function(r,o){var e=this,s=!!a.u(o)||o,n=a.p(r),c=function(Y,S){var _=a.w(e.$u?Date.UTC(e.$y,S,Y):new Date(e.$y,S,Y),e);return s?_:_.endOf(P)},m=function(Y,S){return a.w(e.toDate()[Y].apply(e.toDate("s"),(s?[0,0,0,0]:[23,59,59,999]).slice(S)),e)},g=this.$W,$=this.$M,T=this.$D,b="set"+(this.$u?"UTC":"");switch(n){case w:return s?c(1,0):c(31,11);case M:return s?c(1,$):c(0,$+1);case N:var U=this.$locale().weekStart||0,J=(g<U?g+7:g)-U;return c(s?T-J:T+(6-J),$);case P:case A:return m(b+"Hours",0);case Z:return m(b+"Minutes",1);case D:return m(b+"Seconds",2);case h:return m(b+"Milliseconds",3);default:return this.clone()}},i.endOf=function(r){return this.startOf(r,!1)},i.$set=function(r,o){var e,s=a.p(r),n="set"+(this.$u?"UTC":""),c=(e={},e[P]=n+"Date",e[A]=n+"Date",e[M]=n+"Month",e[w]=n+"FullYear",e[Z]=n+"Hours",e[D]=n+"Minutes",e[h]=n+"Seconds",e[p]=n+"Milliseconds",e)[s],m=s===P?this.$D+(o-this.$W):o;if(s===M||s===w){var g=this.clone().set(A,1);g.$d[c](m),g.init(),this.$d=g.set(A,Math.min(this.$D,g.daysInMonth())).$d}else c&&this.$d[c](m);return this.init(),this},i.set=function(r,o){return this.clone().$set(r,o)},i.get=function(r){return this[a.p(r)]()},i.add=function(r,o){var e,s=this;r=Number(r);var n=a.p(o),c=function($){var T=l(s);return a.w(T.date(T.date()+Math.round($*r)),s)};if(n===M)return this.set(M,this.$M+r);if(n===w)return this.set(w,this.$y+r);if(n===P)return c(1);if(n===N)return c(7);var m=(e={},e[D]=v,e[Z]=k,e[h]=1e3,e)[n]||1,g=this.$d.getTime()+r*m;return a.w(g,this)},i.subtract=function(r,o){return this.add(-1*r,o)},i.format=function(r){var o=this,e=this.$locale();if(!this.isValid())return e.invalidDate||H;var s=r||"YYYY-MM-DDTHH:mm:ssZ",n=a.z(this),c=this.$H,m=this.$m,g=this.$M,$=e.weekdays,T=e.months,b=function(S,_,W,I){return S&&(S[_]||S(o,s))||W[_].slice(0,I)},U=function(S){return a.s(c%12||12,S,"0")},J=e.meridiem||function(S,_,W){var I=S<12?"AM":"PM";return W?I.toLowerCase():I},Y={YY:String(this.$y).slice(-2),YYYY:this.$y,M:g+1,MM:a.s(g+1,2,"0"),MMM:b(e.monthsShort,g,T,3),MMMM:b(T,g),D:this.$D,DD:a.s(this.$D,2,"0"),d:String(this.$W),dd:b(e.weekdaysMin,this.$W,$,2),ddd:b(e.weekdaysShort,this.$W,$,3),dddd:$[this.$W],H:String(c),HH:a.s(c,2,"0"),h:U(1),hh:U(2),a:J(c,m,!0),A:J(c,m,!1),m:String(m),mm:a.s(m,2,"0"),s:String(this.$s),ss:a.s(this.$s,2,"0"),SSS:a.s(this.$ms,3,"0"),Z:n};return s.replace(z,function(S,_){return _||Y[S]||n.replace(":","")})},i.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},i.diff=function(r,o,e){var s,n=a.p(o),c=l(r),m=(c.utcOffset()-this.utcOffset())*v,g=this-c,$=a.m(this,c);return $=(s={},s[w]=$/12,s[M]=$,s[t]=$/3,s[N]=(g-m)/6048e5,s[P]=(g-m)/864e5,s[Z]=g/k,s[D]=g/v,s[h]=g/1e3,s)[n]||g,e?$:a.a($)},i.daysInMonth=function(){return this.endOf(M).$D},i.$locale=function(){return O[this.$L]},i.locale=function(r,o){if(!r)return this.$L;var e=this.clone(),s=d(r,o,!0);return s&&(e.$L=s),e},i.clone=function(){return a.w(this.$d,this)},i.toDate=function(){return new Date(this.valueOf())},i.toJSON=function(){return this.isValid()?this.toISOString():null},i.toISOString=function(){return this.$d.toISOString()},i.toString=function(){return this.$d.toUTCString()},u}(),y=f.prototype;return l.prototype=y,[["$ms",p],["$s",h],["$m",D],["$H",Z],["$W",P],["$M",M],["$y",w],["$D",A]].forEach(function(u){y[u[1]]=function(i){return this.$g(i,u[0],u[1])}}),l.extend=function(u,i){return u.$i||(u(i,f,l),u.$i=!0),l},l.locale=d,l.isDayjs=C,l.unix=function(u){return l(1e3*u)},l.en=O[x],l.Ls=O,l.p={},l}()}}]);